

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Developer Instructions &mdash; locopy 0.6.4 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/documentation_options.js?v=73d9a94e"></script>
      <script src="_static/doctools.js?v=9a2dae69"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="locopy" href="api/modules.html" />
    <link rel="prev" title="SQL Injection" href="sql_injection.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            locopy
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="examples.html">Basic Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="recipes.html">Common Recipes</a></li>
<li class="toctree-l1"><a class="reference internal" href="snowflake.html">Snowflake</a></li>
<li class="toctree-l1"><a class="reference internal" href="sql_injection.html">SQL Injection</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Developer Instructions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#pre-commit-hooks">Pre-Commit Hooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="#generating-documentation">Generating Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#run-unit-tests">Run unit tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="#integration-tests">Integration Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="#management-of-requirements">Management of Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="#edgetest">edgetest</a></li>
<li class="toctree-l2"><a class="reference internal" href="#release-guide">Release Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="#generating-distribution-archives-pypi">Generating distribution archives (PyPI)</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api/modules.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/capitalone/locopy">Github Repo</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">locopy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Developer Instructions</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/developer.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="developer-instructions">
<h1>Developer Instructions<a class="headerlink" href="#developer-instructions" title="Link to this heading">¶</a></h1>
<p>Guidance for developers.</p>
<section id="pre-commit-hooks">
<h2>Pre-Commit Hooks<a class="headerlink" href="#pre-commit-hooks" title="Link to this heading">¶</a></h2>
<p>We use the excellent <a class="reference external" href="https://pre-commit.com/">pre-commit</a> to run several hooks on all changes before commits.
<code class="docutils literal notranslate"><span class="pre">pre-commit</span></code> is included in the <code class="docutils literal notranslate"><span class="pre">dev</span></code> extra installs. You’ll have to run <code class="docutils literal notranslate"><span class="pre">pre-commit</span> <span class="pre">install</span></code> once per environment
before committing changes.</p>
<p>The reason behind running black, isort, and others as a pre-commit hook is to let a machine make style decisions, based
on the collective wisdom of the Python community.</p>
</section>
<section id="generating-documentation">
<h2>Generating Documentation<a class="headerlink" href="#generating-documentation" title="Link to this heading">¶</a></h2>
<p>You will need to <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span></code> the <code class="docutils literal notranslate"><span class="pre">dev</span></code> requirements:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">e</span> <span class="o">.</span><span class="p">[</span><span class="n">dev</span><span class="p">]</span>
</pre></div>
</div>
<p>From the root directory type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">sphinx</span>
</pre></div>
</div>
<p>This will automatically regenerate the api documentation using <code class="docutils literal notranslate"><span class="pre">sphinx-apidoc</span></code>.
The rendered documentation will be stored in the <code class="docutils literal notranslate"><span class="pre">/docs</span></code> directory.  The
GitHub pages sits on the <code class="docutils literal notranslate"><span class="pre">gh-pages</span></code> branch.</p>
<p>To push the documentation changes to the <code class="docutils literal notranslate"><span class="pre">gh-pages</span></code> branch:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">ghpages</span> <span class="o">&amp;&amp;</span> <span class="n">git</span> <span class="n">push</span> <span class="n">origin</span> <span class="n">gh</span><span class="o">-</span><span class="n">pages</span>
</pre></div>
</div>
<p>Note about documentation: The <a class="reference external" href="http://sphinx-doc.org/latest/ext/napoleon.html">Numpy and Google style docstrings</a> are activated by default.
Just make sure Sphinx 1.3 or above is installed.</p>
</section>
<section id="run-unit-tests">
<h2>Run unit tests<a class="headerlink" href="#run-unit-tests" title="Link to this heading">¶</a></h2>
<p>Run <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">coverage</span></code> to run all unittests defined in the subfolder
<code class="docutils literal notranslate"><span class="pre">tests</span></code> with the help of <a class="reference external" href="http://pytest.org/">py.test</a> and
<a class="reference external" href="https://pypi.python.org/pypi/pytest-runner">pytest-runner</a>.</p>
</section>
<section id="integration-tests">
<h2>Integration Tests<a class="headerlink" href="#integration-tests" title="Link to this heading">¶</a></h2>
<p>Run <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">integration</span></code> to run all integration tests (or just run
<code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">not_integration</span></code> to run only unit and not integration tests).  For the
integration tests to work, you will need:</p>
<ul class="simple">
<li><p>A Redshift connection that you can create tables in</p></li>
<li><p>Tokens set up in <code class="docutils literal notranslate"><span class="pre">~/.aws/credentials</span></code> with a profile name</p></li>
<li><p>A file <code class="docutils literal notranslate"><span class="pre">~/.locopyrc</span></code> (<code class="docutils literal notranslate"><span class="pre">~/.locpy-sfrc</span></code> for snowflake) which contains credential information
use for running integration tests. It should look like the following</p></li>
</ul>
<p>Redshift</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my.redshift.cluster.com</span>
<span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5439</span>
<span class="nt">database</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db</span>
<span class="nt">user</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">username</span>
<span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">password</span>
<span class="nt">profile</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MY_AWS_PROFILE</span>
</pre></div>
</div>
<p>Snowflake</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">account</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prod</span>
<span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mycluster.url.com</span>
<span class="nt">warehouse</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">warehouse</span>
<span class="nt">database</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db</span>
<span class="nt">schema</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">schema</span>
<span class="nt">user</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">username</span>
<span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">password</span>
<span class="nt">profile</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MY_AWS_PROFILE</span>
</pre></div>
</div>
<p>The integration tests run through a number of selects, loads and unloads.  They
try to clean up after themselves, but you may not want to run them without
knowing what they’re doing.  Caveat emptor!</p>
</section>
<section id="management-of-requirements">
<h2>Management of Requirements<a class="headerlink" href="#management-of-requirements" title="Link to this heading">¶</a></h2>
<p>Requirements of the project should be added to <code class="docutils literal notranslate"><span class="pre">dependencies</span></code> within our <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code>.  Optional requirements used only for testing,
documentation, or code quality are added to the <code class="docutils literal notranslate"><span class="pre">project.optional-dependencies</span></code> of our <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code>.</p>
</section>
<section id="edgetest">
<h2>edgetest<a class="headerlink" href="#edgetest" title="Link to this heading">¶</a></h2>
<p>edgetest is a utility to help keep requirements up to date and ensure a subset of testing requirements still work.
More on edgetest <a class="reference external" href="https://github.com/capitalone/edgetest">here</a>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> has configuration details on how to run edgetest. This process can be automated via GitHub Actions.</p>
<p>In order to execute edgetest locally you can run the following after install <code class="docutils literal notranslate"><span class="pre">edgetest</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>edgetest<span class="w"> </span>-c<span class="w"> </span>pyproject.toml<span class="w"> </span>--export
</pre></div>
</div>
<p>This should return output like the following and also update our <code class="docutils literal notranslate"><span class="pre">dependencies</span></code> within the <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">=============</span><span class="w">  </span><span class="o">===============</span><span class="w">  </span><span class="o">===================</span><span class="w">  </span><span class="o">=================</span>
Environment<span class="w">    </span>Passing<span class="w"> </span>tests<span class="w">    </span>Upgraded<span class="w"> </span>packages<span class="w">    </span>Package<span class="w"> </span><span class="nv">version</span>
<span class="o">=============</span><span class="w">  </span><span class="o">===============</span><span class="w">  </span><span class="o">===================</span><span class="w">  </span><span class="o">=================</span>
core<span class="w">           </span>True<span class="w">             </span>boto3<span class="w">                </span><span class="m">1</span>.21.7
core<span class="w">           </span>True<span class="w">             </span>pandas<span class="w">               </span><span class="m">1</span>.3.5
core<span class="w">           </span>True<span class="w">             </span>PyYAML<span class="w">               </span><span class="m">6</span>.0
<span class="o">=============</span><span class="w">  </span><span class="o">===============</span><span class="w">  </span><span class="o">===================</span><span class="w">  </span><span class="o">=================</span>
</pre></div>
</div>
</section>
<section id="release-guide">
<h2>Release Guide<a class="headerlink" href="#release-guide" title="Link to this heading">¶</a></h2>
<p>For <code class="docutils literal notranslate"><span class="pre">locopy</span></code> we use a simple workflow branching style and follow
<a class="reference external" href="https://semver.org/">Semantic Versioning</a> for each release.</p>
<p><code class="docutils literal notranslate"><span class="pre">develop</span></code> is the default branch where most people will work with day to day. All features must be squash merged into
this branch. The reason we squash merge is to prevent the develop branch from being polluted with endless commit messages
when people are developing. Squashing collapses all the commits into one single new commit. It will also make it much easier to
back out changes if something breaks.</p>
<p><code class="docutils literal notranslate"><span class="pre">main</span></code> is where official releases will go. Each release on <code class="docutils literal notranslate"><span class="pre">main</span></code> should be tagged properly to denote a “version”
that will have the corresponding artifact on pypi for users to <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">gh-pages</span></code> is where official documentation will go. After each release you should build the docs and push the HTML to
the pages branch. When first setting up the repo you want to make sure your gh-pages is a orphaned branch since it is
disconnected and independent from the code: <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">checkout</span> <span class="pre">--orphan</span> <span class="pre">gh-pages</span></code>.</p>
<p>The repo has a <code class="docutils literal notranslate"><span class="pre">Makefile</span></code> in the root folder which has helper commands such as <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">sphinx</span></code>, and
<code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">ghpages</span></code> to help streamline building and pushing docs once they are setup right.</p>
</section>
<section id="generating-distribution-archives-pypi">
<h2>Generating distribution archives (PyPI)<a class="headerlink" href="#generating-distribution-archives-pypi" title="Link to this heading">¶</a></h2>
<p>After each release the package will need to be uploaded to PyPi. The instructions below are taken
from <a class="reference external" href="https://packaging.python.org/tutorials/packaging-projects/#generating-distribution-archives">packaging.python.org</a></p>
<p>Update / Install <code class="docutils literal notranslate"><span class="pre">setuptools</span></code>, <code class="docutils literal notranslate"><span class="pre">wheel</span></code>, and <code class="docutils literal notranslate"><span class="pre">twine</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="o">--</span><span class="n">upgrade</span> <span class="n">setuptools</span> <span class="n">wheel</span> <span class="n">twine</span>
</pre></div>
</div>
<p>Generate distributions:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="n">sdist</span> <span class="n">bdist_wheel</span>
</pre></div>
</div>
<p>Under the <code class="docutils literal notranslate"><span class="pre">dist</span></code> folder you should have something as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dist</span><span class="o">/</span>
<span class="n">locopy</span><span class="o">-</span><span class="mf">0.1.0</span><span class="o">-</span><span class="n">py3</span><span class="o">-</span><span class="n">none</span><span class="o">-</span><span class="nb">any</span><span class="o">.</span><span class="n">whl</span>
<span class="n">locopy</span><span class="o">-</span><span class="mf">0.1.0</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
</pre></div>
</div>
<p>Finally upload to PyPi:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># test pypi</span>
<span class="n">twine</span> <span class="n">upload</span> <span class="o">--</span><span class="n">repository</span><span class="o">-</span><span class="n">url</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">test</span><span class="o">.</span><span class="n">pypi</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">legacy</span><span class="o">/</span> <span class="n">dist</span><span class="o">/*</span>

<span class="c1"># real pypi</span>
<span class="n">twine</span> <span class="n">upload</span> <span class="n">dist</span><span class="o">/*</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="sql_injection.html" class="btn btn-neutral float-left" title="SQL Injection" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="api/modules.html" class="btn btn-neutral float-right" title="locopy" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018, Capital One Services, LLC.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>